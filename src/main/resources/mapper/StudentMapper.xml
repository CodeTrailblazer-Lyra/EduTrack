<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="xyz.lukix.edutrack.repository.StudentRepository">

    <resultMap id="StudentResultMap" type="xyz.lukix.edutrack.entity.Student">
        <id property="id" column="id"/>
        <result property="stuNum" column="stu_num"/>
        <result property="name" column="name"/>
        <result property="major" column="major"/>
    </resultMap>

    <select id="findAll" resultMap="StudentResultMap">
        SELECT * FROM student WHERE deleted = 0
    </select>

    <select id="findById" resultMap="StudentResultMap" parameterType="long">
        SELECT * FROM student WHERE id = #{id} AND deleted = 0
    </select>

    <insert id="insert" parameterType="xyz.lukix.edutrack.entity.Student" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO student(stu_num, name, major) VALUES(#{stuNum}, #{name}, #{major})
    </insert>

    <update id="update" parameterType="xyz.lukix.edutrack.entity.Student">
        UPDATE student SET stu_num = #{stuNum}, name = #{name}, major = #{major} WHERE id = #{id} AND deleted = 0
    </update>

    <update id="deleteById" parameterType="long">
        UPDATE student SET deleted = 1 WHERE id = #{id}
    </update>

    <select id="existsByStuNum" resultType="boolean" parameterType="string">
        SELECT COUNT(*) > 0 FROM student WHERE stu_num = #{stuNum} AND deleted = 0
    </select>

    <select id="existsByStuNumAndIdNot" resultType="boolean">
        SELECT COUNT(*) > 0 FROM student WHERE stu_num = #{stuNum} AND id != #{id} AND deleted = 0
    </select>

    <select id="findByStuNum" resultMap="StudentResultMap" parameterType="string">
        SELECT * FROM student WHERE stu_num = #{stuNum} AND deleted = 0
    </select>

    <select id="existsById" resultType="boolean" parameterType="long">
        SELECT COUNT(*) > 0 FROM student WHERE id = #{id} AND deleted = 0
    </select>

</mapper>